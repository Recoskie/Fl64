<html>
<head>
  <title>Float64.</title>
</head>
<body  style="overflow:hidden;">
  <style type="text/css">
    <!--
    body { background-image:url(bg/bg.jpg); background-repeat:no-repeat; background-size:cover; -moz-background-size:cover; -webkit-background-size:cover; }
    -->
  </style>
  <script src="FL64.js" type="text/javascript"> </script> 
  <script type="Text/JavaScript">
    var Result = "<style><!--.wrap{ white-space: -moz-pre-wrap !important; white-space: -webkit-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; white-space: normal; }--></style>";
    var sw = false;

    //**********************************************************************************
    //Analyze Fractions, and compare Float 64 format accuracy.
    //**********************************************************************************

    function FractAnalyze()
    {
      var num = GetNumInput( true, true, true ), num2 = num.slice();

      if ( num[ 0 ] === null ) { return; }

      Output( "Simulated." );
      Output( "Division:", ( num[ 0 ] + "&divide;" + num[ 1 ] ) );

      //Find the Division pattern.

      var Data = DivToPat( num[ 0 ], num[ 1 ] );

      //Show the bit pattern.

      if ( Data[ Data.length - 1 ] === -1 )
      {
        Data.pop(); Err( "Simulated Divide to Bit Pattern:", Data ); Data = [ null ];
      }
      else
      {
        Output( "Simulated Divide to Bit Pattern:", ( Data + "&infin; Repeats to Infinity." ) );

        //Convert the pattern into the predicted representation of the floats mantissa bit's.

        Output( "Bit Pattern in Binary:", ( PatToBin( Data ) + "&infin; Repeats to Infinity." ) );

        //Convert the bit pattern into divide.

        var n = PatToDiv( Data );

        Output( "Decode bit pattern back to ?/? = pat:", ( n[ 0 ] + "&divide;" + n[ 1 ] ) );

        //Convert Float value, and division pattern to smallest fraction.

        n = FloatToFract( num[ 0 ] / num[ 1 ], n );

        //Display most reduced fraction.

        if( n[0] !== -1 )
        {
          Output( "Calc (Float&divide;Pat)Exp = Smallest fraction:", ( n[ 0 ] + "&divide;" + n[ 1 ] ) + " = " + ( n[0] / n[1] ) + "" );
        }
      }

      //**********************************************************************************
      //Divide the fraction for real, and decode the real mantissa.
      //**********************************************************************************

      var Float = num2[ 0 ] / num2[ 1 ], fl64 = DecodeFloat( Float );

      Output( "Float64 comparison." );
      Output( "Normal divide:", ( num2[ 0 ] + "&divide;" + num2[ 1 ] + "=" + Float ) );
      Output( "Decode Sing:", fl64[ 0 ] );
      Output( "Decode Exponent:", ToBin( fl64[ 1 ], 11 ) );
      Output( "Decode Mantissa:", ToBin( fl64[ 2 ], 52 ) );

      //Convert the Mantissa into it's bit pattern count.

      Output( "Mantissa Bit pattern count:", BitCount( DecodeMantissa( Float ) ) );

      UpdateOutput();
    }

    //**********************************************************************************
    //Convert an given set of digits to division bit pattern.
    //**********************************************************************************

    function ConvertSetToDiv()
    {
      var Data = GetNumberSet();

      if ( Data[ 0 ] !== null )
      {
        Output( "Translation." );
        Output( "Divide Bit Pattern:", ( Data + "&infin; Repeats to Infinity." ) );
        Output( "Bit Pattern in Binary:", ( PatToBin( Data ) + "&infin; Repeats to Infinity." ) );

        var n = PatToDiv( Data );

        Output( "Decode bit pattern back to ?/? = pat:", ( n[ 0 ] + "&divide;" + n[ 1 ] ) );
        Output( "Test." );
        Output( "Division:", ( n[ 0 ] + "&divide;" + n[ 1 ] ) );

        //Find the Division pattern.

        var Data = DivToPat( n[ 0 ], n[ 1 ] );

        //Show the bit pattern.

        if ( Data[ Data.length - 1 ] === -1 )
        {
          Data.pop(); Err( "Simulated Divide to Bit Pattern:", Data ); Data = [ null ];
        }
        else
        {
          Output( "Simulated Divide to Bit Pattern:", ( Data + "&infin; Repeats to Infinity." ) );
        }
      }

      UpdateOutput();
    }

    //**********************************************************************************
    //Convert Float To, and from binary.
    //**********************************************************************************

    function Binary( Mode )
    {
      var n = 0, fl64 = [], Binary = "", tmep = "";

      //Float to binary.

      if ( Mode === 0 && ( n = GetNumInput( true, false, false )[ 0 ] ) !== null ) { fl64 = DecodeFloat( n ); }

      //Binary to Float.

      else if ( Mode === 1 && ( fl64 = GetFloatBinary() )[ 0 ] !== null ) { n = ToFloat( fl64 ); } else { return; }

      //Show Conversion.

      Output( "Conversion" );

      if( Mode === 0 ) { Output( "Float Value:", n ); } else { Output( "Binary value:", fl64[ 0 ] + ToBin( fl64[ 1 ], 11 ) + ToBin( fl64[ 2 ], 52 ) ); }

      //The sections of the float number.

      Output( "Sing:", ( temp = fl64[ 0 ] ) ); Binary += temp;
      Output( "Exponent:", ( temp = ToBin( fl64[ 1 ], 11 ) ) ); Binary += temp;
      Output( "Mantissa:", ( temp = ToBin( fl64[ 2 ], 52 ) ) ); Binary += temp;
      
      //Conversion result.
      
      if( Mode === 0 ) { Output( "Binary Value:", Binary ); } else { Output( "Float Value:", n ); }

      //Update inputs.

      if( Mode === 1 ) { document.getElementById( "f1" ).value = n; } document.getElementById( "f2" ).value = Binary;

      //Display output.

      UpdateOutput();
    }
    
    //**********************************************************************************
    //Convert Float from binary to fraction.
    //**********************************************************************************

    function BinToFract()
    {
      var fl64 = [], Binary = "", temp = "";

      //Float to binary.

      if ( ( n = GetNumInput( true, false, false )[ 0 ] ) !== null ) { fl64 = DecodeFloat( n ); }

      //The sections of the float number.

      Output( "Float to Binary." );

      Output( "Sing:", ( temp = fl64[ 0 ] ) ); Binary += temp;
      Output( "Exponent:", ( temp = ToBin( fl64[ 1 ], 11 ) ) ); Binary += temp;
      Output( "Mantissa:", ( temp = ToBin( fl64[ 2 ], 52 ) ) ); Binary += temp;
      
      //Conversion result.
      
      Output( "Convert float value." );

      Output( "Mantissa Bit pattern count:", ( temp = BitCount( DecodeMantissa( n ) ) ) + "" );
      
      temp = FindPat( temp );
      
      if ( temp[ temp.length - 1 ] === -1 )
      {
        temp.pop(); Err( "Simulated Divide to Bit Pattern:", temp ); temp = [ null ];
      }
      else
      {
        Output( "Find Pattern:", temp + "&infin; Repeats to Infinity." );
      
        temp = PatToDiv( temp );
        
        Output( "Decode bit pattern back to ?/? = pat:", ( temp[ 0 ] + "&divide;" + temp[ 1 ] ) + "" );
      
        var o = FloatToFract( n, temp );
      
        Output( "Calc (Float&divide;Pat)Exp:", ( o[ 0 ] + "&divide;" + o[ 1 ] ) + " = " + ( o[0] / o[1] ) + "" );
      }
      
      UpdateOutput();
    }
    
    //**********************************************************************************
    //Convert Float from binary to fraction.
    //**********************************************************************************

    function DivToFract()
    {
      var fl64 = [], Binary = "", temp = "";

      //Float to binary.

      if ( ( n = GetNumInput( true, false, false )[ 0 ] ) === null ) { return; }

      //The sections of the float number.

      Output( "Convert float value." );
      Output( "Float Value:", n + "" );
      
      //Conversion result.

      var f1 = ( ( n +"" ).indexOf(".") > 0 ) ? ( n + "" ).split(".")[1] : "", f2 = Math.pow( 10, f1.length ); f1 = parseInt( f1 || 1 ,10);
      
      Output( "Division to Float:", ( f1 + "&divide;" + f2 ) + "" );
      
      temp = DivToPat( f1, f2 );
      
      if ( temp[ temp.length - 1 ] === -1 )
      {
        temp.pop(); Err( "Simulated Divide to Bit Pattern:", temp ); temp = [ null ];
      }
      else
      {
        Output( "Simulated Divide to Bit Pattern:", temp + "&infin; Repeats to Infinity." );
      
        temp = PatToDiv( temp );
        
        Output( "Decode bit pattern back to ?/? = pat:", ( temp[ 0 ] + "&divide;" + temp[ 1 ] ) + "" );
      
        var o = FloatToFract( n, temp );
      
        Output( "Calc (Float&divide;Pat)Exp:", ( o[ 0 ] + "&divide;" + o[ 1 ] ) + " = " + ( o[0] / o[1] ) + "" );
      }
      
      UpdateOutput();
    }

    //**********************************************************************************
    //Get Float binary input format, and check for proper input format.
    //**********************************************************************************

    function GetFloatBinary()
    {
      var fl64 = [ 0, 0, 0 ], s = ( document.getElementById( "f2" ).value ).slice( document.getElementById( "f2" ).value.length - 64 );

      if ( isNaN( document.getElementById( "f2" ).value + "0" ) )
      {
        alert( "\"" + document.getElementById( "f2" ).value + "\" Is Not a binary number." );
        return ( [ null, null, null ] );
      }
      if ( isNaN( ( fl64[ 0 ] = parseInt( s.substring( 0, 1 ), 2 ) ) ) && s.substring( 0, 1 ) !== "" )
      {
        alert( "\"" + s.substring( 0, 1 ) + "\" Is Not a binary number." );
        return ( [ null, null, null ] );
      }
      else if ( isNaN( ( fl64[ 1 ] = parseInt( s.substring( 1, 12 ), 2 ) ) ) && s.substring( 1, 12 ) !== "" )
      {
        alert( "\"" + s.substring( 1, 12 ) + "\" Is Not a binary number." );
        return ( [ null, null, null ] );
      }
      else if ( isNaN( ( fl64[ 2 ] = parseInt( s.substring( 12, 64 ), 2 ) ) ) && s.substring( 12, 64 ) !== "" )
      {
        alert( "\"" + s.substring( 12, 64 ) + "\" Is Not a binary number." );
        return ( [ null, null, null ] );
      }

      if ( s.substring( 0, 1 ) === "" ) { fl64[ 0 ] = 0; } if ( s.substring( 1, 12 ) === "" ) { fl64[ 1 ] = 0; } if ( s.substring( 12, 64 ) === "" ) { fl64[ 2 ] = 0; }

      return ( fl64 );
    }

    //**********************************************************************************
    //Get input, and check for proper input formats.
    //**********************************************************************************

    function GetNumberSet()
    {
      var cmp = document.getElementById( "f1" ).value.split(","), out = [], l = 0;

      for ( var i = 0; i < cmp.length; i++ )
      {
        if ( !isNaN( cmp[ i ] ) )
        {
          out[ l ] = Math.abs( parseInt( cmp[i], 10 ) );
          if( isNaN( out[ l ] ) ) { out.splice( l, 1); } else { l++; }
        }
        else{ alert( "\"" + cmp[ i ] + "\" Is not an number!" ); }
      }

      return ( out );
    }

    //**********************************************************************************
    //Get input, and check for proper input formats.
    //**********************************************************************************

    function GetNumInput( F1, F2, Int_Float )
    {
      var num = [ null, null ];

      if ( F1 && isNaN( document.getElementById( "f1" ).value + "0" ) )
      {
        alert( document.getElementById( "f1" ).value + " = Is not an number." );
      }
      else if( F1 )
      {
        num[ 0 ] = Int_Float ? parseInt( document.getElementById( "f1" ).value, 10 ) : parseFloat( document.getElementById( "f1" ).value, 10 );
      }

      if ( F2 && isNaN( "0" + document.getElementById( "f2" ).value + "0" ) )
      {
        alert( document.getElementById( "f2" ).value + " = Is not an number." );
      }
      else if( F2 )
      {
        num[ 1 ] = Int_Float ? parseInt( document.getElementById( "f2" ).value, 10 ) : parseFloat( document.getElementById( "f2" ).value, 10 );
      }

      if ( isNaN( num[ 0 ] ) )
      {
        num[ 0 ] = 0;
      }
      if ( isNaN( num[ 1 ] ) )
      {
        num[ 1 ] = 0;
      }

      return ( num );
    }

    //**********************************************************************************
    //Update Controls, and input.
    //**********************************************************************************

    function Update( Mode )
    {
      var o = "";

      if ( Mode === 0 )
      {
        o += '<table style="width:100%;height:100%;">';
        o += '<tr>';
        o += '<td style="width:50%;"><input id="f1" style="width:100%;height:100%;text-align:center;font-size:11vh;background-color:rgba(255,255,255,0.5);" onclick="this.select();" type="text" value="1">';
        o += '<\/td>';
        o += '<td>';
        o += '<p style="font-size:11vh">&divide;<\/p>';
        o += '<\/td>';
        o += '<td style="width:50%;"><input id="f2" style="width:100%;height:100%;text-align:center;font-size:11vh;background-color:rgba(255,255,255,0.5);" onclick="this.select();" type="text" value="7">';
        o += '<\/td>';
        o += '<\/tr>';
        o += '<tr>';
        o += '<td colspan="3">';
        o += '<center>';
        o += '<input onclick="FractAnalyze();" style="width:100%;height:42vh;font-size:7vh;" type="button" value="Analyze Fraction">';
        o += '<\/center>';
        o += '<\/td>';
        o += '<\/tr>';
        o += '<\/table>';
      }

      if ( Mode === 1 )
      {
        o += '<table style="width:100%;height:100%;">';
        o += '<tr>';
        o += '<td style="width:50%;"><textarea style="width:100%;height:100%;text-align:center;font-size:3.7vw;background-color:rgba(255,255,255,0.5);" id="f1">1,2,1,1,1,6,1,1,4,3,3,1,4,1,8,2,1,2,2,5,3,1,1,1,3,1,2,4,2,2,3,1,2,1,1,3,2,3,6,5,1,1,1,1,4,1,1,2,1,2,1,3,1,1,3,1,1,1,1,1,1,2,3,2,2,1,1,1,2,1,5,1,3,2,1,1,2,2,2,1,3,4,1,2,2,1,2,1,1,1<\/textarea>';
        o += '<\/td>';
        o += '<\/tr>';
        o += '<tr>';
        o += '<td>';
        o += '<input onclick="ConvertSetToDiv();" style="width:100%;height:42vh;font-size:7vh;" type="button" value="Convert To Fraction">';
        o += '<\/td>';
        o += '<\/tr>';
        o += '<\/table>';
      }

      if ( Mode === 2 )
      {
        o += '<table style="width:100%;height:100%;">';
        o += '<tr>';
        o += '<td colspan="3"><input id="f1" style="width:100%;height:100%;text-align:center;font-size:4.347826vw;background-color:rgba(255,255,255,0.5);" onclick="this.select();" type="text" value="3.1415926535"><\/td>';
        o += '<\/tr>';
        o += '<tr>';
        o += '<td colspan="3"><input id="f2" style="width:100%;height:100%;text-align:center;font-size:1.40625vw;background-color:rgba(255,255,255,0.5);" type="text" value="0100000000001001001000011111101101010100010000010001011101000100"><\/td>';
        o += '<\/tr>';
        o += '<tr>';
        o += '<td><input type="button" style="width:100%;height:100%;font-size:2vh;" value="Float To Binary" onclick="Binary(0)"><\/td>';
        o += '<td><input type="button" style="width:100%;height:100%;font-size:2vh;" value="Binary to Float" onclick="Binary(1)"><\/td>';
        o += '<td><input type="button" style="width:100%;height:100%;font-size:2vh;" value="Auto Update Inputs" onclick="Update(3)"><\/td>';
        o += '<\/tr>';
        o += '<\/table>';
      }

      if ( Mode === 3 )
      {
        o += '<table style="width:100%;height:100%;">';
        o += '<tr>';
        o += '<td><input id="f1" style="width:100%;height:100%;text-align:center;font-size:4.347826vw;background-color:rgba(255,255,255,0.5);" onclick="this.select();" onkeypress="Binary(0)" onkeyup="Binary(0)" type="text" value="3.1415926535"><\/td>';
        o += '<\/tr>';
        o += '<tr>';
        o += '<td><input id="f2" style="width:100%;height:100%;text-align:center;font-size:1.40625vw;background-color:rgba(255,255,255,0.5);" onkeypress="Binary(1)" onkeyup="Binary(1)" type="text" value="0100000000001001001000011111101101010100010000010001011101000100"><\/td>';
        o += '<\/tr>';
        o += '<tr>';
        o += '<td><input type="button" style="width:100%;height:100%;font-size:2vh;" value="Disable Auto Update" onclick="Update(2)"><\/td>';
        o += '<\/tr>';
        o += '<\/table>';
      }
      
      if ( Mode === 4 )
      {
        o += '<table style="width:100%;height:100%;">';
        o += '<tr>';
        o += '<td colspan="2"><input id="f1" style="width:100%;height:100%;text-align:center;font-size:4.347826vw;background-color:rgba(255,255,255,0.5);" onclick="this.select();" type="text" value="3.1415"><\/td>';
        o += '<\/tr>';
        o += '<tr>';
        o += '<td><input type="button" style="width:100%;height:100%;font-size:2vh;" value="Bin to Fract" onclick="BinToFract()"><\/td><td><input type="button" style="width:100%;height:100%;font-size:2vh;" value="Div to Fract" onclick="DivToFract()"><\/td>';
        o += '<\/tr>';
        o += '<\/table>';
      }

      document.getElementById( "c" ).innerHTML = o;
      document.getElementById( "out" ).innerHTML = "";
      document.getElementById( "OutSize" ).width = "0px;";
    }

    //**********************************************************************************
    //Simplify displaying output.
    //**********************************************************************************

    function Output( MSG, Data )
    {
      if ( arguments.length <= 1 )
      {
        if ( sw )
        {
          Result += "<\/table>";
          sw = false;
        }
        Result += "<p style=\"font-size:4.2vh;\">" + MSG + "<\/p>";
      }
      else if ( !sw )
      {
        Result += "<table style=\"font-size:2.2vh;width:40vw;width:100%;\" border=\"1\">";
        sw = true;
      }
      if ( sw )
      {
        Result += "<tr><td style=\"white-space:nowrap\">" + MSG + "<\/td><td class=\"wrap\">" + Data + "<\/td><\/tr>";
      }
    }

    function UpdateOutput()
    {
      document.getElementById( "OutSize" ).width = "40vw;";
      document.getElementById( "out" ).innerHTML = '<iframe frameborder="0" style="height:81vh;width:40vw;" id = "o"></iframe>';
      document.getElementById( "o" ).contentWindow.document.write ( "<center>" + Result + "<\/table></center>" );
      document.getElementById( "o" ).contentWindow.stop();
      sw = false; Result = "<style>.wrap{ white-space: -moz-pre-wrap !important; white-space: -webkit-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; white-space: normal; }</style>";
    }

    function SetForce() { Force( confirm("Warning setting forced calculation can lead to freezing the page as some calculations take an long time.") ); }

    function Err( MSG, Data )
    {
      var out = "Calculation Stopped because it is slow.";
      if( arguments.length > 1 ) { out += "<input type='button' value='Show data.' onclick='parent.Preview(\"" + Data + "\");' />"; }
      out += "<input type='button' value='Force Calculations!' onclick='parent.SetForce();' />";
      Output( MSG, out );
    }

    function Preview( data )
    {
      ( window.open( "", "_blank", "" ) ).document.write( "<textarea style='width:100%;height:100%;'>" + data + "<\/textarea>" );
    }
  </script>
	
  <!--Mode selection-->

  <center>
    <table border="1" style="width:100%; height:16%; background-color:rgba(156,156,156,0.4);">
      <tr>
        <td>
          <center>
            <p style="font-size:3vh;">Analyze Fractions:</p>
            <input checked name="c" onclick="Update(0);" type="radio">
          </center>
        </td>
        <td>
          <center>
            <p style="font-size:3vh;">Patterns to Fractions:</p>
            <input name="c" onclick="Update(1);" type="radio">
          </center>
        </td>
        <td>
          <center>
            <p style="font-size:3vh;">Float64 binary converter:</p>
            <input name="c" onclick="Update(2);" type="radio">
          </center>
        </td>
        <td>
          <center>
            <p style="font-size:3vh;">Float to Fraction:</p>
            <input name="c" onclick="Update(4);" type="radio">
          </center>
        </td>
      </tr>
    </table>
	  
    <!--Controls and input=-->

    <table border="2" style="width:100%;height:84%;background-color:rgba(255,255,255,0.5);">
      <tr valign="top">
        <td>
          <center>
            <div id="c" style="height:78vh;">
              <table style="width:100%;height:100%;">
                <tr>
                  <td style="width:50%;"><input id="f1" onclick="this.select();" style="width:100%;height:100%;text-align:center;font-size:11vh;background-color:rgba(255,255,255,0.5);" type="text" value="1"></td>
                  <td><p style="font-size:11vh;">&divide;</p></td>
                  <td style="width:50%;"><input id="f2" onclick="this.select();" style="width:100%;height:100%;text-align:center;font-size:11vh;background-color:rgba(255,255,255,0.5);" type="text" value="7"></td>
                </tr>
                <tr>
                  <td colspan="3">
                    <center>
                      <input onclick="FractAnalyze();" style="width:100%;height:42vh;font-size:7vh;" type="button" value="Analyze Fraction">
                    </center>
                  </td>
                </tr>
              </table>
            </div>
          </center>
        </td>
		  
        <!--The output-->
        
        <td style="overflow:hidden;vertical-align:top" id="OutSize"> <div id="out"> </div> </td>
      </tr>
    </table>
  </center>
</body>
</html>

<html>
  <body>
    <script src="FL64.js" type ="text/javascript"></script>
    <script type="Text/JavaScript">
    function Update( Mode )
    {
      var o = "";
      
      if( Mode === 0 )
      {
        o += "<table border=\"1\">";
        o += "<tr><td>Analyze Float64 Fractions.</td></tr>";
        o += "<tr>";
        o += "<td>Fract: <input type=\"text\" id=\"f1\" />&divide;<input type=\"text\" id=\"f2\" /><input type=\"button\" value=\"Analyze Fraction.\" onclick=\"FractAnalyze();\" / ></td>";
        o += "</tr>";
        o += "</table>";
      }
      
      if( Mode === 1 )
      {
        o += "<table border=\"1\">";
        o += "<input type=\"text\" id=\"f1\" value=\"3,1\" /> <input type=\"button\" value=\"Translate\" onclick=\"ConvertSetToDiv()\" />";
        o += "</table>";
      }
      
      document.getElementById("c").innerHTML = o;
    }

    function FractAnalyze()
    {
      var num1 = null, num2 = null, str = "";
      
      try
      {
        num1 = parseInt( document.getElementById("f1").value, 10 );
      }
      catch( e ) { num1 = NaN; }
      
      try
      {
        num2 = parseInt( document.getElementById("f2").value, 10 );
      }
      catch( e ) { num2 = NaN; }
      
      if( num1 === null || num2 === null || isNaN( num1 ) || isNaN( num2 ) )
      {
        if( document.getElementById("f1").value === "" || document.getElementById("f2").value === "" )
        {
          str += "Enter numbers to divide by.";
        }
        else if( isNaN(num1) )
        {
          str += document.getElementById("f1").value+" = Is not an number.";
        }
        else if( isNaN(num2) )
        {
          str += document.getElementById("f2").value+" = Is not an number.";
        }
      }
      else
      {
        str = "<h1>Accurate simulated divide.</h1>"
        
        //Display data in an nice table.
        
        str += "<table border=\"1\">";
        
        //Show the fraction to be divided.
        
        str += "<tr><td>Division:</td><td> " + num1 + "&divide;" + num2 + "</td></tr>";
        
        //Find the Division pattern.
        
        var Data = DivToPat( num1, num2 );
        
        //Show the bit pattern.
        
        str += "<tr><td>Divide Bit Pattern:</td><td>";
        
        if( Data[ Data.length - 1 ] === -1 )
        {
          Data.pop();
          str += "Calculation Stoped because it is slow.<input type='button' value='Show data.' onclick='Preview(\""+Data+"\");' />";
          str += "<input type='button' value='Force Calculations!' onclick='Force(true);FractAnalyze();' />";
          Data = [ null ];
        }
        else
        {
          str += Data + "</td></tr>";
          
          //Convert the pattern into the predicted representation of the floats mantissa bit's.
          
          str += "<tr><td>Bit Pattern to Binary Number:</td><td>" + PatToBin( Data ) + "&infin; Repeats to Infinity." + "</td></tr>";
          
          //Convert the bit pattern into divide.
          
          var n1 = 1, n2 = 1;
          
          var n = PatToDiv( Data );
          
          n1 = n[0]; n2 = n[1];
          
          var Float = num1 / num2;
          
          if( ( n1 !== null && n2 !== null ) )
          {
            str += "<tr><td>Decode bit pattern back to ?/? = pat:</td><td>" + n1 + "&divide;" + n2 + "</td></tr>";
          
            //Compute Nominator.
            
            var e = Float / ( n1 / n2 ); n1 *= e;
          
            //Exponent adjust.
          
            while( ( n1 - Math.floor( n1 ) ) !== 0 ) { n1 *= 2; n2 *= 2; }
          
            //Display most reduced fraction.
          
            str += "<tr><td>Smallest fraction:</td><td>" + n1 + "&divide;" + n2 + "</td></tr>";
          }
          else { str += "<tr><td>Warning:</td><td>Bit pattern is too big and out of range.</td></tr>"; }
        }
        
        str += "</table>";
        
        //**********************************************************************************
        //Divide the fraction for real, and decode the real mantissa.
        //**********************************************************************************
        
        str += "<h3>Actual divide using JavaScript Float64 Format.</h3>";
        str += "<table border=\"1\">";
        
        //Decode native Float64 format.
        
        var Float = num1 / num2;
        
        var fl64 = DecodeFloat( Float );
        
        str += "<tr><td>Float Value:</td><td>" + Float + "</td></tr>";
        str += "<tr><td>Sing:</td><td>" + fl64[0] + "</td></tr>";
        str += "<tr><td>Exponent:</td><td>" + ToBin( fl64[1], 11 ) + "</td></tr>";
        str += "<tr><td>Mantissa:</td><td>" + ToBin( fl64[2], 52 ) + "</td></tr>";
        
        //Convert the Mantissa into it's bit pattern count.
        
        str += "<tr><td>Float Mantissa Bit pattern count:</td><td>" + BitCount( DecodeMantissa( Float ) ) + "</td></tr>";
        str += "</table>";
      }
      
      document.getElementById("out").innerHTML = str;
    }
    
    function ConvertSetToDiv()
    {
      var Data = [null];
      
      try{ eval("Data = [" + document.getElementById("f1").value + "];"); }
      catch(e)
      {
        alert("Input Error.\r\Numbers in an set must be entered followed by an comma.\r\nExample: 10, 20, 1, 11");
      }
      
      if( Data[0] !== null )
      {
        for(var i = 0; i < Data.length; i++) { if( isNaN( parseInt(Data[i], 10) ) ) { alert( "\"" + Data[i] + "\" Is not an number!" ); Data[0] = null; } }
      }
      
      if( Data[0] !== null )
      {
        var str = "<h1>Translation.</h1>"
        
        str += "<table border=\"1\">";
        str += "<tr><td>Divide Bit Pattern:</td><td>" + Data + "</td></tr>";
        str += "<tr><td>Bit Pattern to Binary Number:</td><td>" + PatToBin( Data ) + "&infin; Repeats to Infinity." + "</td></tr>";
        
        var n = PatToDiv( Data );
        
        str += "<tr><td>Decode bit pattern back to ?/? = pat:</td><td>" + n[0] + "&divide;" + n[1] + "</td></tr>";
        str += "</table>";
        
        document.getElementById("out").innerHTML = str;
      }
      
      
    }
    
    function Preview( data )
    {
      ( window.open( "", "_blank", "" ) ).document.write( "<textarea style='width:100%;height:100%;'>" + data + "</textarea>" );
    }
    </script>
    <center>
      <table border="1">
        <tr>
          <td>Analyze Fractions: <input type="radio" name="c" onclick="Update(0);" checked /></td>
          <td>Patterns to Fractions: <input type="radio" name="c" onclick="Update(1);" /></td>
        </tr>
      </table>
      <div id = "c">
        <table border="1">
          <tr><td>Analyze Float64 Fractions.</td></tr>
          <tr>
            <td>Fract: <input type="text" id="f1" />&divide;<input type="text" id="f2" /><input type="button" value="Analyze Fraction." onclick="FractAnalyze();" / ></td>
          </tr>
        </table>
      </div>
      <div id="out"></div>
    </center>
  </body>
</html>
